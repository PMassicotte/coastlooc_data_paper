---
title: "COASTLOOC data paper"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    highlight: zenburn
    css: "theme.css"
    toc: true
    toc_float:
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "center",
  cache = TRUE
)

library(here)
library(tidyverse)
library(kableExtra)
```

## Data cleaning and pre-processing

This section shows the main steps that have been applied to pre-process the raw data.

### aCDOM spectra

- The CDOM spectra were modeled according to the information in Babin 2003.

  - `acdom` spectra were re-fitted using the complete data (i.e. between 350-500 nm) because the data in `all_abs_transpose.txt` started at 380 nm.

- Average background values calculated between 683-687 nm and subtracted from each spectra.

- Some files were in binary format, so I could not open them (ex.: `C2001000.YSA`).

- Some spectra start at 300 nm while others at 350 nm.

- Calculated the correlation between the measured and the fitted values.

  - Fits with R2 than 0.99 were removed from the data.

- Exported the complete spectra (350-700 nm): both the raw and the modeled data.

### Phytoplankton and non-algal absorption

- Nothing special was done with this data. I just transposed the data.

### Irradiance

- There were negative values in the irradiance data (`Ed`, `Eu`, `Kd`, `Ku`). I have cleaned the data by setting these negative values to `NA`.

- `Eu` is in fact `Eu0-` that was estimated estimated using a two-exponential function model.

- `Ed` is in fact `Ed0-` calculated from `0.94 x ed0+`.

### Reflectance

- Reflectance values outside the 0-1 range were set to `NA`.

### Other stuff

- Extracted extra variables (`DOC`, `AQY`) from Massimo 2000.

## Orientation of the paper

- The data is a mix of temporal and spatial observations, so how should we present the data?

- By `area`?

## Visualizations

Just some graphs to visualize the data. *Note that the same color palette will be used to represent the areas in all graphics.*

### Geographical map

There is a total of 424 different stations that were sampled during the COASTLOOC expeditions.

- Note that there are two stations without geographical coordinates: `C2001000`, `C2002000`.

```{r}
knitr::include_graphics(here("graphs/02_geographic_map.png"))
```

### Available variables

Just an overview of the available variables (excluding radiometric measurements).

```{r}
knitr::include_graphics(here("graphs/06_number_observation_nutrient_by_area.png"))
```

### Absorption measurements

Overview of the averaged absorption spectra for each area.

```{r}
knitr::include_graphics(here("graphs/11_average_absorption_spectra_by_area.png"))
```

Comparing `acdom443` for the different areas shows that there is a clear open to coastal gradient.

```{r}
knitr::include_graphics(here("graphs/13_boxplot_acdom443_by_area.png"))
```

We can see that the `DOC` follows the same pattern as `acdom443`.

```{r}
knitr::include_graphics(here("graphs/12_boxplot_doc_by_area.png"))
```

We can also use scatter-plots to further explore the relationships among variables.

```{r}
knitr::include_graphics(here("graphs/13_aphy_vs_anap.png"))
```

Relationships between some pigments.

```{r}
knitr::include_graphics(here("graphs/nano_chla_vs_hexanoyloxyfucoxanthin_19.png"))
```

### Irradiance

#### Ed

```{r}
knitr::include_graphics(here("graphs/07_ed_spectral_profiles_by_area.png"))
```

#### Eu

```{r}
knitr::include_graphics(here("graphs/07_eu_spectral_profiles_by_area.png"))
```

#### Kd

```{r}
knitr::include_graphics(here("graphs/07_kd_spectral_profiles_by_area.png"))
```

#### Ku

```{r}
knitr::include_graphics(here("graphs/07_ku_spectral_profiles_by_area.png"))
```

## TODOS

- No absorption for `Med. Sea (Case 1)`. Is it normal?

- There are a lot of nutrient parameters that have values of zero. Are they true zero or indicate missing values?
