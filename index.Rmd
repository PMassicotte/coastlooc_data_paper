---
title: "COASTLOOC data paper"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    highlight: zenburn
    css: "theme.css"
    toc: true
    toc_float:
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "center",
  cache = TRUE
)

library(here)
library(tidyverse)
```

## What has been done

This section shows the main steps that have been applied to pre-process the raw data.

### aCDOM spectra

-   The CDOM spectra were modeled according to the information in Babin 2003.

    -   `acdom` spectra were re-fitted using the complete data (i.e. between 350-500 nm).

-   Average background values calculated between 683-687 nm.

-   Some files were in binary format, so I could not open them (ex.: `C2001000.YSA`).

-   Some spectra start at 300 nm while others at 350 nm.

-   Calculated the correlation between the measured and the fitted values. Fits with R2 than 0.99 were removed from the data.

-   Exported the complete spectra (350-700 nm): both the raw and the modeled data.

### Phytoplankton and non-algal absorption

-   Original data had average background calculated between 745 and 750 nm. This average background have been re-added to the spectra. Thereafter, a new averaged background values were calculated between 746 and 750 nm and subtracted from the spectra.

### Irradiance

-   There were negative values in the irradiance data (`Ed`, `Eu`, `Kd`, `Ku`). I have cleaned the data by setting these negative values to `NA`.

    -   **To validate**

### Other stuff

-   Extracted extra variables (`DOC`, `AQY`) from Massimo 2000.

## Visualizations

Just some graphs to visualize the data. *Note that the same color palette will be used to represent the areas in all graphics.*

### Geographical map

```{r}
knitr::include_graphics(here("graphs/04_geographic_map.png"))
```

### Available variables

Just an overview of the available variables (excluding radiometric measurements).

```{r}
knitr::include_graphics(here("graphs/07_number_observation_nutrient_by_area.png"))
```

### Absorption measurements

Overview of the averaged absorption spectra for each area. The `acdom` spectra have been refitted from the original/raw spectra corrected with the new 746-750 nm background.

```{r}
knitr::include_graphics(here("graphs/12_average_absorption_spectra_by_area.png"))
```

Comparing `acdom443` for the different areas shows that there is a clear open to coastal gradient.

```{r}
knitr::include_graphics(here("graphs/14_boxplot_acdom443_by_area.png"))
```

We can see that the `DOC` follows the same pattern as `acdom443`.

```{r}
knitr::include_graphics(here("graphs/13_boxplot_doc_by_area.png"))
```

We can also use scatterplots to further explore the relationships among variables.

```{r}
knitr::include_graphics(here("graphs/14_aphy_vs_anap.png"))
```

Relationships between some pigments.

```{r}
knitr::include_graphics(here("graphs/nano_chla_vs_hexanoyloxyfucoxanthin_19.png"))
```

## TODOS

-   There are two stations without geographical coordinates: `C2001000`, `C2002000`.

-   Find a good way to flag the data:

    -   For example, all `a_phy`, `a_nap`, `a_tot` spectra contain negative absorption values, but this does not mean they are bad spectra.

-   There are a lot of nutrient parameters that have values of zero. Are they true zero or indicate missing values?

-   Orientation of the paper

    -   The data is a mix of temporal and spatial observations, so how should we present the data?

        -   By `area`?

### Irradiance data

-   `Eu` means that `Eu0-` was estimated (see with Marcel, I do not remember what it means).

-   `Ed` is `Ed0-` calculated from `0.96 x ed0+`.

    -   Change the name in the data files `ed` to `ed0-`.

### Reflectance

-   There are negative values.

### AC9

-   `a(715)` is always at 0.

-   There are negative values.
